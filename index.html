<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Sentiment</title>
    <!-- Used for 3d environment-->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <!-- include ar.js for A-Frame to allow for ar-interaction like marker tracking-->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script>      
    // Create a function that creates the initial distance of the object, if the user is moving subtract 
    // the delta from the object and recreate it and scale it to the appropriate size (if needed). Only
    // include 2 images, create a functionality to add specified image with a taskbar at the top.
      setInterval(function() {
        getLocation();
        var latitutde = position.coords.latitude;
        var longitude = position.coords.longitude;

        if ((position.coords.latitude >= (latitude + 0.005)) && (position.coords.longitude >= (longitude + 0.005))) {
          updateImageLocation(0);
        } else if ((position.coords.latitude >= (latitude + 0.005)) && (position.coords.longitude <= (longitude - 0.005))) {
          updateImageLocation(1);
        } else if ((position.coords.latitude <= (latitude - 0.005)) && (position.coords.longitude >= (longitude + 0.005))) {
          updateImageLocation(2);
        } else if ((position.coords.latitude <= (latitude - 0.005)) && (position.coords.longitude <= (longitude - 0.005))) {
          updateImageLocation(3);
        }
      }, 250);

      function updateImageLocation(val) {
        let img1 = document.querySelector('image-1');
        let img2 = document.querySelector('image-2');

        // if (val == 0) {
        //   img1.setAttribute('position', {x: , y: , z: });
        //   img2.setAttribute('position', {x: , y: , z: });
        // } else if (val == 1) {
        //   img1.setAttribute('position', {x: , y: , z: });
        //   img2.setAttribute('position', {x: , y: , z: });
        // } else if (val == 2) {
        //   img1.setAttribute('position', {x: , y: , z: });
        //   img2.setAttribute('position', {x: , y: , z: });
        // } else {
        //   img1.setAttribute('position', {x: , y: , z: });
        //   img2.setAttribute('position', {x: , y: , z: });
        // }  
      }

      function getLocation() {
        navigator.geolocation.getCurrentPosition(showPosition);
      }
  
      function showPosition(position) {
        console.log(position.coords.latitude + " = lat test 1");
        console.log(position.coords.longitude + " = long test 1");
        // gps1.value = `latitude: ${position.coords.latitude - 0.001}; longitude: ${position.coords.longitude + 0.001}`;

        let image1 = document.querySelector('a-image');
        let gps1 = document.createAttribute('gps-entity-place');
        let lat1 = getNewLatitude(position.coords.latitude, 1);
        let long1 = getNewLongitude(position.coords.latitude, position.coords.longitude, 0);
        gps1.value = `latitude: ${lat1}; longitude: ${long1}`;
        image1.setAttributeNode(gps1);

        let image2 = document.querySelector('a-image');
        let gps2 = document.createAttribute('gps-entity-place');
        let lat2 = getNewLatitude(position.coords.latitude, -3);
        let long2 = getNewLongitude(position.coords.latitude, position.coords.longitude, 0);
        gps2.value = `latitude: ${lat2}; longitude: ${long2}`;
        image2.setAttributeNode(gps2);

        let image3 = document.querySelector('a-image');
        let gps3 = document.createAttribute('gps-entity-place');
        let lat3 = getNewLatitude(position.coords.latitude, 0);
        let long3 = getNewLongitude(position.coords.latitude, position.coords.longitude, 0);
        gps3.value = `latitude: ${lat3}; longitude: ${long3}`;
        image3.setAttributeNode(gps3);
      }

      function getNewLatitude(latitude, meters) {
        //Update latitude of image
        var earth = 6378.137,  //Radius of earth in KM
        pi = Math.PI,
        m = (1 / ((2 * pi / 360) * earth)) / 1000;  //1 meter in degrees
        var new_latitude = latitude + (meters * m);
        console.log(new_latitude + " = lat test 2");
        return new_latitude;
      }

      function getNewLongitude(latitude, longitude, meters) {
        //Update longitude of image
        var earth = 6378.137,  //Radius of earth in KM
        pi = Math.PI,
        cos = Math.cos,
        m = (1 / ((2 * pi / 360) * earth)) / 1000;  //1 meter in degrees
        var new_longitude = longitude + (meters * m) / cos(latitude * (pi / 180));
        console.log(new_longitude + " = long test 2");
        return new_longitude;
      }
      </script>
  </head>
  <body style="margin: 0; overflow: hidden;" onload="getLocation()">
    <div id="buttonBanner" position="relative" height="5%">
      <button id="placeImage">Leave Note</button> 
    </div>
    <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <img id="image-1" src="img/I_love_you.png"></a-image>
        <img id="image-2" src="img/Screenshot_3.png"></a-image>
        <img id="image-3" src="img/don't_panic.png"></a-image>
      </a-assets>

      <a-image src="#image-1" height="0.5" width="0.5" position="0 2 -3" cross-origin="Anonymous"></a-image>
      <a-image src="#image-2" height="1" width="1" position="1 2 -3" cross-origin="Anonymous"></a-image>
      <a-image src="#image-3" height="0.5" width="1" position="-1 2 -3" cross-origin="Anonymous"></a-image>
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>
  </body>
</html>